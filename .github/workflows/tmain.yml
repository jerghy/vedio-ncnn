name: Run Real-ESRGAN

on: [push, pull_request]

jobs:
  run-realesrgan:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Ensure executable permissions
      run: |
        icacls realesrgan/realesrgan-ncnn-vulkan.exe /grant Everyone:F

    - name: Download test image
      run: |
        curl -L -o input.png https://example.com/path/to/your/input.png

    - name: Run Real-ESRGAN
      run: |
        .\realesrgan\realesrgan-ncnn-vulkan.exe -i input.png -o output_image.png > output.log 2> error.log
      continue-on-error: true

    - name: Print error log if any
      if: failure()
      run: |
        echo "Real-ESRGAN failed to run. Printing error log:"
        type error.log
        echo "Printing output log:"
        type output.log
    - name: Upload logs
      if: failure()
      uses: actions/upload-artifact@v2
      with:
        name: logs
        path: |
          output.log
          error.log

